package me.xingz.scheduler;

import me.xingz.file.Deaggregator;
import me.xingz.schema.Schema;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.annotation.EnableScheduling;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;
import sun.jvm.hotspot.utilities.Interval;

import java.io.BufferedInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URL;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.util.concurrent.ScheduledFuture;

/**
 * Created by xzhou on 5/19/17.
 */
@EnableScheduling
@Component
public class Scheduler {
//    private final String URL_CHINA = "http://download.finance.yahoo.com/d/quotes.csv?s=SINA+SOHU+NTES+BIDU+NCTY+KZ+JRJC+CTRP+JOBS+UTSI+CNTF+SMI+ACTS+EDU+VISN+AMCN+ACH+CEO+CYD+GSH+CHL+LFC+SORL+CHA+SNP+SHI+CEA+EFUT+HNP+ZNH+CSIQ+CBAK+CAAS+CHNR+NDAC+FFHL+NTE+DL+STV+XIN+ATV+SOL+TSL+YGE+CISG+HIMX+JASO+OIIM+SIMO+PTR+CHU+ASX+AUO+TSM+UMC+SPIL+GIGM+CYOU+HTHT+CHT+SYUT+CCGM+SFUN+DYNP+CCIH+NOAH+BITA+XNY+KNDI+CNET+ATAI+LIWA+YUII+HEAT+TXIC+JKS+RINO+DQ+CRTP+CHBT+HGSH+SEED+BEST+WATG+CCME+FUQI+GSOL+GURE+CAST+CADC+JFC+WUHN+FEED+CO+RCON+ABAT+HOLI+KONE+SPU+CIIC+CPHI+APWR+CREG+SINO+JGBO+CHNG+SCEI+CLNT+CHIO+CXDC+CELM+CJJD+CCM+SBAY+ALN+BSPM+CDII+CALI+SVA+CGA+VALV+NOEC+BORN+ONP+OSN+VNET+RENN+NQ+FENG+ZX+CNIT+VIPS+YY+DSWL+AAAE+APWC+IMOS+AACAY+ACGBY+AGVO+AHCHY+AICAF+AIDA+AIVI+AKRK+ALMMF+AMVGF+ANGGY+CMFO+AMCG+AMGY+HPJ+LEDS+ARTB+BACHY+BCAUY+BCHM+BCMXY+BDEV+BNSO+EVK+NEWN+CNR+EGT+BEER+BEIJF+BELLY+BFAR+BHKLY+BJCHF+BJINY+BKEAY+SGOC+CLWT+BOTRF+BOTX+BSDGY+BSHG+IDI+BYDDF+CABLF+CAGM+HIHO+KGJI+NFEC+MPEL+CAOVY+CARCY+CASDY+CBEH+CBGH+CBLUY+CBUMY+CBRAF+SSW+CCCGY+JMHLY+CBPO+XHFNF+HGHN+JPAK+HGKGY+KEYP+HHGM+KMSWF+HIGR+XNFHF+HIIDY+XNGSY+XSELY+XYIGF+HKAEY+YINGY+YIPCF+JADA+YYINE+KRYPY+ZHAOF+PPCCY+JELCY+HKXCF+PSGP+QING+KURU+RDBO+RNFU+RNHEF+JEXYF+SEXHF+KWHAY+JEXYY+SGHIY+JIXAY+SHALY+LEGE+SHANF+SHGXY+SHKLY+LKHLY+SHTDF+SHTGY+TRUHY+TSGTF+TSYHY+TTNDY+XNWU+LMPMY+LTUS+MAANF+MAORF+MLLUY+NANI+TVBCY+CEVIY+TXNM+NIVS+UOLI+CHME+NOBGF+CCCL+WGHGY+VTSYF+NWRLY+SLUXY+SLVA+SNAS+SNFRY+SNLAY+OPEI+UIBGF+WGLD+HKXCY+HLDCY+HLDVF+HLPPY+HMCTF+HNLGF+HNLGY+HOKCY+CHCC+HOWWY+CHCG+SRRY+CHDA+HQGE+STTFY+HRELF+SUHJY+CHDP+CHEUY+SWRAY+HRELY+SYUP+HSNGY+HSYT+SOUG+HTCMY+HUABF+HUIHY+HUIY+HYSNY+IDCBF+IDCBY+IDCX+IICN+IINHY+IKTSY+XYIGY+TSGTY+CHPN+CHPXY+CHWTF+CHHE+CHSY+CICHY+ZHDM+ZHEXF+CITAY+ZHYLF+CICOY+CIDHY+CHSTY+CIVN+CIFHY+CIHD+CIHKY+ZIJMF+CHOR+ZLIOY+ZTCOF+CHLBF+CIWT+ZYCI+TAAI+TCEHY+TCEPY+TCYMF+CKGT+CKUN+SHWGY+SHZNY+SIMTF+OROVY+TCTZF+TCYMY+SIELY+SIOLY+TRUHF+SWRBY+ORSX+PBEP+CHNC+PIAIF+PKSGY+KSTV+WOSSF+WSYS+WTFS+WUMSF+WWNTF+WYNMF+ZHEXY+ZIJMY+ZTCOY+WUMSY+WWNTY+WYNMY+MNOIY+NOBGY+CLPXY+CMAKY+CMNW+PNGAY+CNER+CPCAY+CPDV+CPKPF+CRHKY+CRHO+CRJI+CRUI+CHOLY+CHOLF+CRWOY+CSDXY+CSEHY+CSGH+CSGJ+CSKD+CCGY+CSNH+CSOL+CSRGY+CSUAY+CSWG+CSWYY+CTEK+CTHL+CTPCY+CTVZ+CPKPY+HUAZ+CCOZY+CCOZF+CDBH+CDBT+CDGXF+CDSG+AIRYY+BACHF+BCAUF+BKEAF+CICHF+BYDDY+DPNEY+DRCR+DUKS+DXIN+EAST+EESC+EKONY+ENHD+ESPGY+FEPU+FIRRY+FLMS+FPAFF+FXCNY+GGDVY+GHII+GIGNF+GIGNY+GMDTF+GOEG+GPHG+GTVI+GWLLY+GXYEF+GXYEY+GZPHY+GZUHY+HDVTY+HEGIF+HEGIY+FPAFY+CVPH+CWPWF+CWYCY+CYDI+CYHM+CYIG+DCRD+DFEL+DFIHY+DGDH+DGWIY+DION+DIPGY+DKSP+DNFGF+DNGH+DPNEF+DNFGY+LITB+PME+CCCR+WUBA+WBAI+ATHM+AMC+NVFY+WB+TEDU+LEJU+KANG+JD+TOUR+CMCM+GOAS+JMEI+ZPIN+XNET+BABA+SKYS+EHIC+MOMO+HLG+JP+YRD+BGNE+YIN+COE+JMU+GSUM+CLDC+ZTO+BSTI&f=sabc1p2jkj6k5t8";
//    private final String URL_1 = "http://download.finance.yahoo.com/d/quotes.csv?s=LIFE+JBHT+ICLN+COWNL+AMD+GTIM+AEHR+ESPR+GSHTW+NRCIB+TWNK+POPE+OIIM+TAX+ALDR+BRQSW+ARTNA+ALNY+CSIQ+ENDP+EHR+CBLI+FLXN+DUSA+CMFN+PCSB+AMZN+FULT+GLPI+HONE+NVIV+EBMT+FOXF+MNRO+MBSD+PACB+JBSS+LPTX+CODA+GWPH+ASET+FTXO+ENZY+AMNB+FTXG+PEIX+INGN+GHDX+BCACU+CYOU+JMBA+APOP+FPRX+MRIC+FTW+MTEX+IGLE+PFIN+MSTR+LOXO+IGF+KNSL+PFIS+BABY+GARS+CHUY+CBF+AVHI+GPACU+INO+ATACR+BMCH+CSX+NTNX+HWBK+FV+NEWTL+EPAY+ORIT+MSFG+EVLMC+STPP+CYAD+HURN+ABTX+FJP+EMXC+MOBL+KTOS+NEXT+NGHC+ANDAR+PBBI+MSON+ASPS+CVBF+GOODP+CNCE+CTHR+FOMX+CNCR+CBPO+FMB+OESX+GOODO+MDXG+ICBK+UEPS+FCBC+PGLC+LYTS+OXBR+WRLSU+FMBI+PBPB+GBLI+RKDA+HBIO+COHU+INCR+ONB+FEUZ+RDVY+MNTX+VNET+CELH+IIN+LNGR+CNTF+PCYG+NEOG+DYSL+NEOS+CACG+NVGN+NXTDW+MBCN+DMTX+HYGS+HBANO+ELECW+CERN+IOTS+OTTR+OTTW+GTHX+RNMC+MRLN+FTGC+HBANP+QLC+CHUBA+GOOGL+LINU+LINK+MRSN+LIND+FNK+CFCOW+BEBE+HFWA+QINC+IUSG+CNACR+MBRX+IUSB+FGM+CTBI+OREX+HYLS+ATAI+DFFN+OHAI+CHFC+CODX+HLIT+DAKT+EGOV+FELE+CPTAL+BASI+HAFC+PYZ+BWINA+CTXRW+OZRK+FMCIW+BRKL+NYMTO+IVAC+ESGD+ORBC+IFV+GWRS+HDS+CHSCP+CHSCO+COLB+BMRC+CYCCP+PKW+ADAP+EMKR+GFED+DENN+CCUR+HCCI+PIRS+CSOD+EVOL+SHV+CSJ+ITEK+DISCK+ORLY+JACK+OCFC+XOG+MGI+WIFI+LXRX+ALGN+AIMT+OSPRU+CBAY+MMDMR+AGIO+BLVDW+MCBC+NWBI+ISM+IVFVC+MERC+PGTI+GNUS+MMAC+CMCO+EFOI+LRAD+PODD+LBIX+MASI+ALQA+ESDI+EXPE+CRWS+EQBK+CART+EHTH+BFIN+CDTI+CARO+CTWS+CARG+XT+GBCI+INFI+TUR+ITIC+MNGA+AIMC+KLAC+ALCO+LBTYB+MINI+ISBC+LBTYK+GNTY+PPSI+ABIL+BLCM+HMHC+OHRP+AQMS+TLT+NBRV+IDCC+KBAL+DMRC+AOBC+FYX+ALJJ+BIOS+AKAM+LMNX+FKO+ENFC+MIND+NESRW+ALXN+CYBE+BOFI+ICAD+MPACW+KEQU+AIRG+CALD+ACHN+AMSWA+SOXX+LCNB+IMMR+GIGA+QQXT+NICE+HIFS+EAGL+AGEN+CHEK+LTBR+KIDS+BPMC+CFNB+MFIN+AETI+INBKL+BUSE+HSON+CETV+CTSO+FRAN+IAC+PXLW+BCTF+NTRSP+CTRE+FCAN+EQFN+BOSC+PLCE+TACOW+KMPH+TUSK+IIJI+IRTC+CYHHZ+CRME+AMAG+EMB+AFHBL+ESRX+AMAT+LWAY+GSHT+EYEGW+HGSH+GSM+OPOF+CCMP+MAGS+DRIO+CLCT+CTXR+GTYH+FTSM+CSGP+PDFS+MSCC+MCHI+MTGEP+PSL+GYRO+MKTX+CNXR+KFRC+MELI+MCHP+NTCT+MPWR+ILG+CRVS+LHCG+CMRX+CPLP+FISI+FDT+FISV+INAP+CRVL+PRFT+CASC+PPBI+ANDA+CASH+HSGX+BLRX+OPTT+FTHI+PAAS+WRLS+COMT+IEI+GALE+ATRS+FEYE+BLDR+NBIX+HUNTU+FCEF+MLNK+GFNCP+NYMT+GRFS+MLNX+PPIH+QQQX+ASND+FNSR+BCLI+FHK+CBMG+MNTA+OFED+AMED+CVO+CKPT+OCRX+CUTR+ADUS+ARCI+LTXB+KERX+BWFG+NRIM+ASRV+ROCK+FRPH+GOOD+GRPN+KONA+MTP+AERI+ADRD+TACO+MYNDW+OACQU+JOUT+ESES+NANO+ACRX+MAPI+ARDM+NXEO+DXCM+NMRX+HBHCL+ALPN+CTRN+BL+BMLA+LFUS+BLIN+CLMT+CTRP+GPRO+DARE+JASN+PHIIK+ATHN+GBNK+CGNX+CHRW+MYL+DGICB+APEI+CGNT+HSIC+RILYZ+NVAX+ORRF+HOFT+CLFD+FTLB+FNTEW+BSFT+WYIGU+EDIT+TREE+NTRS+AMKR+CDXC+JRVR+CFBI+INOV+FITBI+OFIX+FONE+CHCO+CETXP+AAON+CHTR+CYAN+GMLP+CTIC+MMDM+IDRA+KLIC+PCTY+ACOR+ODFL+DAIO+BDGE+CNIT+NEPT+CFFN+NEWTZ+LVNTA+CPAH+ESGG+CHDN+FBIO+MOXC+ANGI+LCUT+WOOD+HTLF+FMNB+ACAD+KOPN+ATOM+GLBS+FLDM+ADHD+LEXEA+BGFV+NH+ATTU+YDIV+OBCI+PHII+ISIG+PME+MCRI+LAWS+CORE+KMDA+NDRAW+LULU+BCOV+GILT+NTIC+MBWM+CXDC+BIDU+PTIE+NAUH+BMRN+BOOM+LMRKO+EEI+NLNK+FAAR+HQY+GBDC+KELYB+FEMS+GNMA+DERM+HTHT+MXIM+MSG+MTSC+PDCE+PCAR+AMMA+WIRE+EIGR+PETQ+MCEF+ARKR+PBSK+PLAY+CUBN+AEZS+FMCI+FCCO+MOSY+ISRG+CCXI+GNBC+AMTX+PFI+INDY+ILMN+ANCX+CATS+BHBK+MRTX&f=sabc1p2jkj6k5t8";
    private final String[] urls;
    private final Deaggregator deaggregator;

    @Autowired
    public Scheduler(Schema schema) {
        this.deaggregator = new Deaggregator(schema);
        urls = new String[]{
                "http://download.finance.yahoo.com/d/quotes.csv?s=LIFE+JBHT+ICLN+COWNL+AMD+GTIM+AEHR+ESPR+GSHTW+NRCIB+TWNK+POPE+OIIM+TAX+ALDR+BRQSW+ARTNA+ALNY+CSIQ+ENDP+EHR+CBLI+FLXN+DUSA+CMFN+PCSB+AMZN+FULT+GLPI+HONE+NVIV+EBMT+FOXF+MNRO+MBSD+PACB+JBSS+LPTX+CODA+GWPH+ASET+FTXO+ENZY+AMNB+FTXG+PEIX+INGN+GHDX+BCACU+CYOU+JMBA+APOP+FPRX+MRIC+FTW+MTEX+IGLE+PFIN+MSTR+LOXO+IGF+KNSL+PFIS+BABY+GARS+CHUY+CBF+AVHI+GPACU+INO+ATACR+BMCH+CSX+NTNX+HWBK+FV+NEWTL+EPAY+ORIT+MSFG+EVLMC+STPP+CYAD+HURN+ABTX+FJP+EMXC+MOBL+KTOS+NEXT+NGHC+ANDAR+PBBI+MSON+ASPS+CVBF+GOODP+CNCE+CTHR+FOMX+CNCR+CBPO+FMB+OESX+GOODO+MDXG+ICBK+UEPS+FCBC+PGLC+LYTS+OXBR+WRLSU+FMBI+PBPB+GBLI+RKDA+HBIO+COHU+INCR+ONB+FEUZ+RDVY+MNTX+VNET+CELH+IIN+LNGR+CNTF+PCYG+NEOG+DYSL+NEOS+CACG+NVGN+NXTDW+MBCN+DMTX+HYGS+HBANO+ELECW+CERN+IOTS+OTTR+OTTW+GTHX+RNMC+MRLN+FTGC+HBANP+QLC+CHUBA+GOOGL+LINU+LINK+MRSN+LIND+FNK+CFCOW+BEBE+HFWA+QINC+IUSG+CNACR+MBRX+IUSB+FGM+CTBI+OREX+HYLS+ATAI+DFFN+OHAI+CHFC+CODX+HLIT+DAKT+EGOV+FELE+CPTAL+BASI+HAFC+PYZ+BWINA+CTXRW+OZRK+FMCIW+BRKL+NYMTO+IVAC+ESGD+ORBC+IFV+GWRS+HDS+CHSCP+CHSCO+COLB+BMRC+CYCCP+PKW+ADAP+EMKR+GFED+DENN+CCUR+HCCI+PIRS+CSOD+EVOL+SHV+CSJ+ITEK+DISCK+ORLY+JACK+OCFC+XOG+MGI+WIFI+LXRX+ALGN+AIMT+OSPRU+CBAY+MMDMR+AGIO+BLVDW+MCBC+NWBI+ISM+IVFVC+MERC+PGTI+GNUS+MMAC+CMCO+EFOI+LRAD+PODD+LBIX+MASI+ALQA+ESDI+EXPE+CRWS+EQBK+CART+EHTH+BFIN+CDTI+CARO+CTWS+CARG+XT+GBCI+INFI+TUR+ITIC+MNGA+AIMC+KLAC+ALCO+LBTYB+MINI+ISBC+LBTYK+GNTY+PPSI+ABIL+BLCM+HMHC+OHRP+AQMS+TLT+NBRV+IDCC+KBAL+DMRC+AOBC+FYX+ALJJ+BIOS+AKAM+LMNX+FKO+ENFC+MIND+NESRW+ALXN+CYBE+BOFI+ICAD+MPACW+KEQU+AIRG+CALD+ACHN+AMSWA+SOXX+LCNB+IMMR+GIGA+QQXT+NICE+HIFS+EAGL+AGEN+CHEK+LTBR+KIDS+BPMC+CFNB+MFIN+AETI+INBKL+BUSE+HSON+CETV+CTSO+FRAN+IAC+PXLW+BCTF+NTRSP+CTRE+FCAN+EQFN+BOSC+PLCE+TACOW+KMPH+TUSK+IIJI+IRTC+CYHHZ+CRME+AMAG+EMB+AFHBL+ESRX+AMAT+LWAY+GSHT+EYEGW+HGSH+GSM+OPOF+CCMP+MAGS+DRIO+CLCT+CTXR+GTYH+FTSM+CSGP+PDFS+MSCC+MCHI+MTGEP+PSL+GYRO+MKTX+CNXR+KFRC+MELI+MCHP+NTCT+MPWR+ILG+CRVS+LHCG+CMRX+CPLP+FISI+FDT+FISV+INAP+CRVL+PRFT+CASC+PPBI+ANDA+CASH+HSGX+BLRX+OPTT+FTHI+PAAS+WRLS+COMT+IEI+GALE+ATRS+FEYE+BLDR+NBIX+HUNTU+FCEF+MLNK+GFNCP+NYMT+GRFS+MLNX+PPIH+QQQX+ASND+FNSR+BCLI+FHK+CBMG+MNTA+OFED+AMED+CVO+CKPT+OCRX+CUTR+ADUS+ARCI+LTXB+KERX+BWFG+NRIM+ASRV+ROCK+FRPH+GOOD+GRPN+KONA+MTP+AERI+ADRD+TACO+MYNDW+OACQU+JOUT+ESES+NANO+ACRX+MAPI+ARDM+NXEO+DXCM+NMRX+HBHCL+ALPN+CTRN+BL+BMLA+LFUS+BLIN+CLMT+CTRP+GPRO+DARE+JASN+PHIIK+ATHN+GBNK+CGNX+CHRW+MYL+DGICB+APEI+CGNT+HSIC+RILYZ+NVAX+ORRF+HOFT+CLFD+FTLB+FNTEW+BSFT+WYIGU+EDIT+TREE+NTRS+AMKR+CDXC+JRVR+CFBI+INOV+FITBI+OFIX+FONE+CHCO+CETXP+AAON+CHTR+CYAN+GMLP+CTIC+MMDM+IDRA+KLIC+PCTY+ACOR+ODFL+DAIO+BDGE+CNIT+NEPT+CFFN+NEWTZ+LVNTA+CPAH+ESGG+CHDN+FBIO+MOXC+ANGI+LCUT+WOOD+HTLF+FMNB+ACAD+KOPN+ATOM+GLBS+FLDM+ADHD+LEXEA+BGFV+NH+ATTU+YDIV+OBCI+PHII+ISIG+PME+MCRI+LAWS+CORE+KMDA+NDRAW+LULU+BCOV+GILT+NTIC+MBWM+CXDC+BIDU+PTIE+NAUH+BMRN+BOOM+LMRKO+EEI+NLNK+FAAR+HQY+GBDC+KELYB+FEMS+GNMA+DERM+HTHT+MXIM+MSG+MTSC+PDCE+PCAR+AMMA+WIRE+EIGR+PETQ+MCEF+ARKR+PBSK+PLAY+CUBN+AEZS+FMCI+FCCO+MOSY+ISRG+CCXI+GNBC+AMTX+PFI+INDY+ILMN+ANCX+CATS+BHBK+MRTX&f=sabc1p2jkj6k5t8",
                "http://download.finance.yahoo.com/d/quotes.csv?s=BOCH+EXLS+GAIN+ICLR+ERIE+GSHTU+ACET+MANT+BYSI+MDRX+PHMD+DMPI+CCOI+ITUS+EVAR+CWAY+CYTXW+MNKD+GLPG+CIVBP+PBHC+PMPT+JNP+ICCC+XRAY+PSTB+OTIV+LMAT+BLVD+WILC+EVK+FTXR+CME+NESR+BHACR+PCH+LPTH+DSWL+BPFHP+FOLD+FTXD+AAWW+BCACR+FEIM+MBOT+PVAC+LITE+IOVA+DIOD+CUNB+KVHI+AXSM+FTC+ARII+UDBI+FFIN+CPRX+PEBK+FULLL+NAKD+FIVN+ALOG+HIMX+EACQW+NDAQ+HLG+INDUU+DEPO+NUAN+OLLI+SWIN+EVLV+ACIW+LMOS+FSBW+CTG+AUDC+EBIX+ACIA+ORIG+CRUS+KAAC+BGNE+ARTX+FCA+POWI+POWL+SUSC+DDBI+ABEOW+LJPC+MNOV+CLSD+DOVA+CLSN+LANDP+AHGP+CTMX+PUB+GNCA+MXWL+LMB+OVLY+IAM+ADBE+FFNW+FARM+WRLSW+MYOK+FMBH+MITL+DSKE+CSSE+EEFT+BELFB+ERI+BELFA+LE+FLKS+IRIX+BKEP+FBNK+MNDO+III+FBNC+JSMD+FLEX+FTNT+NVTR+FORM+AGNCB+MMSI+FDUS+BANF+GRID+GRIF+MMDMU+FORR+PFMT+GLAD+LKOR+IAMXR+NCLH+OLBK+CRAY+CLDX+CALL+AGFSW+AVDL+LSBK+FIZZ+KALA+MICT+FSFG+GPIC+MSBI+PBIB+LINC+CFCOU+IMPV+NBCP+IESC+XENT+LONE+CNACU+TDIV+YLDE+PLUS+DZSI+ESLT+ARCB+HBNC+FFWM+CHI+ATAX+PACW+MAYS+CHW+NNBR+HNNA+MPCT+AMRK+LAKE+AMRB+OSBC+ORBK+NLST+ALRN+HTBK+FUV+HDP+FCFS+CHSCL+COLM+NCOM+OPGN+CELGZ+AVGO+PLPM+BPOPM+OBAS+ONVO+AVGR+ASML+DISCA+APOPW+SHY+PBNC+CRESY+NK+BKSC+CLDC+CBAN+BBGI+ALGT+NVCN+LARK+BLBD+CREE+CREG+ESCA+OSPRW+OPGNW+JSYNW+CLRB+MBFIP+HIBB+LOGI+CLRO+CVGW+CNET+LBRDK+FCSC+ONCS+APPS+NXEOW+LORL+MDIV+EXPO+DGII+MZOR+JKI+AVNW+CDTX+FKLY+CSWC+NERV+NGHCZ+FPXI+CARB+BSQR+DTUL+BLUE+SOCL+EGLT+COBZ+HOVNP+NHLD+APDNW+NOVT+CTAS+GTYHW+GOV+CLIRW+BHACU+GSIT+PRKR+CADC+KRNT+MACQU+MRDN+ACCP+FYC+CYTK+HBAN+BIIB+CYTX+IMI+ARRS+MYGN+ARRY+BUFF+CCCR+INTC+BEAT+AABA+SKIS+AMDA+INTU+AZPN+FKU+UHAL+IPCI+FPAY+GLYC+BDSI+NKTR+IMMU+MBUU+ENTA+QAT+AAPL+DFBG+CNTY+IOSP+FTXL+KCAP+THRM+HBK+PERI+LKFN+GPAC+DVCR+LIVE+BCBP+NGHCP+CDNA+AEGN+CTSH+ARAY+FITB+FVE+RNEM+LINDW+OFS+NAII+PDCO+CSPI+HAS+GPP+FCAL+ISTB+CAVM+CEMP+ISTR+ANAB+INBK+PMTS+MMLP+CRMT+EML+GBT+EACQ+CVTI+CNSL+PNFP+NVLN+OXLCO+OXLCM+ABMD+BOKFL+IMNP+CONN+HWKN+MGIC+BNFT+ENPH+AKER+EGRX+NFEC+APTI+FTSL+ECHO+INPX+CPIX+MRDNW+GNTX+CZNC+IMKTA+CNXN+MCHX+KBLMR+FRSH+INWK+OPK+CWCO+HRTX+ASTC+BSPM+NDLS+ATLO+BMLP+FSV+CBMXW+CASM+DLTR+OMED+DCIX+SNLN+ETSY+CASY+GALT+ATRI+IEP+CY+GNST+GEMP+BLDP+HUNTW+NYMX+AXON+ALIM+BLMT+BVXV+CDK+BLMN+HSTM+FTAG+CMCSA+EARS+INSE+FNTE+CVV+DFVS+EVSTC+BYFC+INSY+OSUR+QCLN+NTLA+MBB+FAB+PDLI+PLYA+ADRU+BBRX+BBRY+IBOC+KONE+ADRA+CBRL+QTEC+ICPT+OACQW+PANL+PRSS+HOTR+MPAA+CSCO+LAMR+ESEA+FRBA+FATE+FTEO+AAXN+HMNF+FSC+MTBC+CCD+CTRV+ANIP+CPSS+PIH+CHMG+CRZO+FWONA+COGT+FDIV+AVIR+GAINN+MBIO+ATHX+BWLD+ACGLO+ALBO+JJSF+ISCA+JVA+SKOR+ACGLP+NXST+CDXS+BWINB+AKTS+GSBC+TWOU+NCBS+HUNT+HCSG+EFBI+CHCI+DNBF+NYMTP+FMAX+MCFT+AAOI+IVTY+DGLY+LGCYP+DFRG+CVLY+JMU+KINS+INVA+BHAC+JAZZ+CFFI+LVNTB+AGIIL+ECPG+MPB+FENC+ARLZ+MTRX+FBIZ+NITE+BREW+HOPE+CLIR+GLBZ+PAVM+CGEN+GLBR+IRDM+AFSI+JBLU+BIOC+NIHD+ASPU+OVID+ONSIZ+FTFT+BIOL+NCMI+BIOP+HBCP+IMMY+DMLP+CSML+XELA+CUR+EBAYL+ACHV+HWCC+CORT+BOFIL+ABUS+FEP+PRTK+CUI+ICON+GDS+HAYN+NSSC+IMOS+CYCC+MDWD+NVDA+CMTL+JUNO+SGQI+BBSI+QYLD+DISH+OXBRW+NEWT+GIGM+BNTC+AHPAW+LRGE+SAUC+LNTH+PETS+SMCP+DAX+JCOM+FPA+ATOS+COKE+MLHR+AHPA+PZRX+MPVD+MACK+INDU+IPXL+KCAPL+PFF+SELF+PFM+CATM+LCAHW+KELYA+RFEM+INDB+SQZZ+GRVY+PFBX&f=sabc1p2jkj6k5t8",
                "http://download.finance.yahoo.com/d/quotes.csv?s=CIVB+CCFI+PDVW+SQLV+FALN+MGNX+ORMP+LTRX+NRCIA+LVHD+NXPI+CLRBZ+MTGE+BSTC+ALDX+AVAV+GECCL+PTNR+LMRK+MANH+AGLE+IXUS+ADTN+OSN+ONEQ+OSBCP+CSII+OTIC+TAPR+MAT+IFEU+ITRI+AMCN+OKTA+LRCX+BOXL+CMPR+ENZL+CRTO+IBTX+HBMD+OXFD+FTXH+HMTV+FTXN+DWLD+CHKE+ICUI+GECC+APOG+ELEC+DCOM+FLWS+TWNKW+IPWR+CENTA+EFSC+NWLI+FLAT+NBTB+MHLD+LOAN+BCRX+NSEC+ELSE+CEVA+FIVE+NGHCO+FFIC+MFINL+PEBO+CLLS+FTCS+MB+MTLS+EACQU+ALOT+WYIG+ATACU+ETRM+FSBC+CDNS+FSBK+GWGH+BANFP+MGRC+DOX+LBAI+POLA+HURC+KTOV+ANDAU+JSM+NATI+MBVX+BSF+CLAR+SUSB+APVO+ACWI+JRJC+FMK+EKSO+EFAS+FGEN+NTAP+RFAP+GNCMA+BKYI+ASCMA+EVEP+LTRPB+LTRPA+MYOS+CAR+FARO+RNDM+CAC+MITK+COHR+BNCL+BVSN+PGC+ADES+PTSI+JSML+BATRA+MDCA+BATRK+CELC+FRPT+AKRX+BANR+NTWK+ACBI+RAIL+PAVMW+ANTH+CACC+CMLS+PLBC+EDGW+NVUS+ALKS+FLXS+DXTR+CALI+EDGE+CALM+BECN+IEUS+PRCP+AAAP+NUVA+FORTY+CHUBK+NYNY+KALU+KALV+MSBF+NWFL+CLVS+PLUG+ESXB+EXTR+ASTE+MEOH+IUSV+FOGO+PCOM+CNOB+OBLN+ESND+MFSF+CHFS+AMRN+LGCY+ESGU+PESI+CDOR+CNFR+BRKS+ESGE+NTEC+AMRS+EXFO+HZNP+RILY+CHSCM+PKBK+ABEO+FIXD+RING+GOVNI+EDBI+JCS+BPOPN+ONVI+SNSR+LPLA+IIIN+HTGM+DISCB+AEIS+BOBE+EA+LUNA+ENT+ATXI+CSQ+CZR+CBAK+ARWR+MFNC+ACXM+AGII+JSYNR+HFBC+PLXP+OTEX+HLNE+ELON+MIII+FSCFL+ADSK+AAME+LAND+IPHS+KAACW+APPN+NXEOU+LGND+DWAC+GEVO+BRID+LSCC+DTUS+IONS+IAMXW+NVFY+CJJD+GSVC+CSTE+MRVL+CSTR+HMSY+FTRI+FMAO+INFO+NOVN+KE+DNKN+ASFI+ARNA+LTEA+EGLE+CARZ+GTYHU+AGRX+NGHCN+BOMN+AUBN+IZEA+EUFN+MACQW+KRNY+CRIS+AKCA+FOANC+PTLA+PNBK+MPACU+GEOS+CAMP+CAMT+BOTZ+DRYS+LAUR+BPFH+PNNT+IMTE+OMCL+OBSV+LMNR+GLRE+CRNT+FSAM+BRQS+PYPL+FWRD+INTX+CCCL+NWPX+LGIH+NICK+AIRR+GFN+FIBK+NFLX+ENTG+IFMK+ENTL+BPTH+CVCO+JD+BPFHW+WYIGW+OMAB+AMSC+PWOD+NNDM+OHGI+LIVN+MYRG+FCAP+IART+AWRE+CETX+HDNG+CLNT+FNY+JNCE+OVBC+LSXMK+NVMI+LSXMB+MAMS+EVGBC+CGIX+SHLM+NHLDW+BRCD+JOBS+MSDI+AEY+DLBL+HELE+GPOR+PMBC+EWZS+IXYS+BUR+FANH+IBKC+EAGLU+TILE+KRMA+FFBC+FBSS+LMRKP+DSKEW+APTO+JAKK+PBCTP+IBKR+HALL+AINV+FRSX+MELR+ACNB+EVGN+CBIO+KBLMW+OPB+ASUR+OPHC+ABCD+BKCC+PEGI+PEZ+OVAS+MRUS+AOSL+KLXI+NEXTW+DVY+FDEF+FSZ+ATLC+PZZA+LLEX+RFDI+OMEX+CASS+OMER+CXRX+ATRA+OCLR+ASRVP+EXAC+LOCO+MLCO+ABDC+FUSB+MOGLC+KTEC+BCPC+EXAS+KOSS+PLW+QQQC+CCRC+CYBR+GBLIZ+HUBG+CCRN+CDW+FFKT+TYPE+ASNA+LOB+CIU+INSG+YLCO+AKBA+INSM+DFVL+PATI+MIME+ARCC+AIA+PPC+EMITF+CCIH+IMRN+AMBA+FAD+ALTY+FDBC+CNMD+HPT+HYXE+MIIIW+BIVV+NUROW+OCUL+BBRG+EXXI+MGEN+ACRS+BNSO+MPAC+CRSP+LMFA+ATNX+CPSH+ANIK+CTRL+GRBK+KPTI+BV+FFHL+CONE+CIZN+HBP+JASO+AVID+HCAP+ABCB+ONTX+TURN+ALLT+HSII+GAINO+EEMA+MBII+BOLD+MRCY+NDRA+MRCC+BOLT+RILYL+CPTA+FNTEU+CLNE+LECO+NTRP+BOKF+NTRI+NTRA+IVENC+AKAO+KANG+ARGS+OSIS+INOD+FMCIR+HA+FONR+CIDM+DTEA+CVLT+NBEV+PCTI+LOPE+SCZ+CSBR+NSTG+LGCYO+DHIL+APLP+IBCP+MVIS+OTEL+FSACW+GOGO+AMPH+MYSZ+BNTCW+BSET+BKEPP+CZFC+ACTG+FCVT+NEO+NXTD+MLVF+ZEUS+ADXSW+KTWO+ICHR+BMTC+PFLT+AVEO+CGO+AGYS+MGCD+GGAL+FAST+AEMD+NBN+QVCA+GLUU+ADP+BCOM+BBBY+CPHC+BCOR+AZRX+IJT+ACHC+FRME+BFIT+EBAY+CLBS+IPAR+DJCO+DRNA+AMOV+FLL+FNBG+KOOL+NEWA+CMTA+MSDIW+SVVC+KRYS+NEWS+GNMK+FEMB+AFAM+DTYS+AHPAU+MCEP+CERCW+EIGI+ALSK+AQB+QQEW+DTYL+PETX+CFBK+JXSB+THFF+ESG+HBHC+PLAB+IRCP+CATB+DSPG+CATH+ARLP+LCAHU+DRIOW+NCSM+CATY+CECO&f=sabc1p2jkj6k5t8",
                "http://download.finance.yahoo.com/d/quotes.csv?s=NDSN+LSTR+MARPS+CZWI+IDXG+IDXX+ERII+ACER+GAIA+ERIC+HEES+ASMB+IBKCP+CVCY+CRBP+DHXM+BOJA+UAE+GLADN+APRI+LION+CLWT+MEIP+MARA+MAR+AMCX+ICCH+GCBC+PTEN+ACLS+ITRN+PSTI+PYDS+AMCA+EMCI+EGBN+CRTN+CSWI+CHKP+EMCF+BHACW+PCO+ESIO+CAFD+KTOVW+AROW+BCACW+DVAX+FNGN+FSLR+GRMN+FTR+ADOM+IGLD+FFIV+FTA+GLMD+BBOX+CPRT+MTEM+HCM+LPSN+GPACW+BLFS+MU+APDN+INDUW+EBIO+CROX+ABAC+ACIU+AMGN+CLRBW+FB+COST+IDTI+CCBG+FH+EDUC+MSFT+MDVX+ARTW+NATR+ANDAW+GFNSL+NATH+PCBK+GIFI+TAST+LQDT+ATEC+ESBK+RNLC+KNDI+FMI+ACWX+GOODM+CATYW+CYRXW+AUPH+IRDMB+QABA+ALT+MGYR+OACQ+MOTA+ITCI+IBB+WRLSR+FNJN+CBMX+ABAX+IRBT+GSUM+OMNT+BLPH+MDLZ+INCY+ATNI+BJRI+KWEB+ONS+HIHO+CELG+FORK+NSYS+AGNCN+ACERW+NEON+ORPN+CWBC+JAGX+NEOT+DWPP+FRGI+ABY+EZPW+HBANN+CERC+CBSHP+DOTAU+BHF+PNK+CERS+BLKB+CDZI+GENE+CRAI+LLIT+COWN+CBOE+FNX+CSFL+DORM+DYNT+FSFR+GIII+DLHC+MLAB+CBFV+OSPR+GERN+CNACW+RXDX+MOFG+PCRX+HCAPZ+CHFN+ATAC+CPTAG+ESDIW+CHY+EGHT+SNAK+FTRPR+BWEN+FMCIU+NTES+AXAS+HTBX+ESGR+BRKR+ALRM+GURE+ACTA+OFLX+HTBI+ATSG+DXPE+OCC+CHSCN+ISNS+EWBC+BMRA+MTFB+ECYT+LAYN+SLQD+PPHM+HSKA+PAYX+EVOK+AFH+BICK+ENG+MRAM+ACFC+FORD+CCLP+MTBCP+NHTC+MEDP+NVCR+ADRE+MMDMW+CRED+HFBL+CVGI+BLVDU+NURO+JSYNU+XLRN+PLXS+HMTA+CBSH+DWAT+KAACU+AXDX+LANC+ASV+LBRDA+CSBK+LMFAW+APPF+CMCT+JASNW+EXPD+ETFC+DELTW+CARV+MTFBW+CIBR+FSTR+HMST+FCNCA+CARA+MDGS+ELECU+INFN+PAHC+IKNX+ITI+VIVO+ADXS+HNRG+AREX+INFR+OXLC+LBTYA+AAL+ANSS+DWSN+IRMD+MGLN+DXLG+ABIO+PATK+NKSH+BOTJ+MMYT+SRET+LILAK+BKMU+CNBKA+ATVI+FYT+TEAM+CYTR+FSAC+OSTK+HOLX+INTL+CFMS+NODK+HOLI+CALA+MILN+POOL+CFRX+OTG+KIRK+AIRT+PKOH+NWSA+IFGL+GTLS+DTRM+FNLC+EPZM+ONTXW+AVXS+IRWD+AMSF+CNAT+FSNN+PICO+PERY+CNAC+AVXL+MTCH+DRRX+CIFS+EXEL+FVC+ADMA+BGCP+HAWK+ADMP+ADMS+ANAT+LNDC+LSXMA+ITEQ+CHNR+EDAP+KIN+CEMI+TUSA+HVBC+HQCL+AFMD+BRACU+FNWB+DLBS+LPCN+MGPI+FANG+DBVT+FFBW+IVFGC+IIVI+GEC+EAGLW+ICFI+CTXS+PI+ADVM+AGNC+MKSI+CSGS+KTCC+FUNC+CHEKW+HALO+IPGP+IMRNW+KBSF+OPHT+KURA+CDEV+KBLMU+LCA+GENC+LMBS+GABC+FTD+CFCO+BZUN+PEGA+ACGL+DAVE+FNHC+CHMA+PNTR+CASI+DLTH+GLDD+EBTC+NSIT+AMWD+JKHY+PENN+COOL+ATRC+IBKCO+IMGN+FLGT+CA+NWS+ATRO+FRED+NVEE+COMM+NCNA+CAAS+IEF+MRNS+KBLM+FCEL+ISHG+MORN+MBFI+GBLIL+IFON+ARCW+AXGN+FHB+CLXT+EVBG+IDSA+AMBCW+KGJI+MNST+MBTF+PDLB+EXA+DCPH+AMBC+GOOG+DEST+AUTO+NETE+IDSY+MIIIU+HPJ+MESO+OACQR+ADRO+NTGR+SATS+ASYS+LLNW+ACST+ARDX+HSNI+CPSI+FTEK+GLNG+HMNY+AGTC+AAXJ+MGEE+GPRE+CIGI+FWP+CENX+FWONK+IROQ+PIE+CENT+FLIR+PIZ+DGICA+EMMS+HNH+FFBCW+GAINM+APEN+PFSW+NDRM+NAVI+OASM+HCOM+MOMO+WATT+LOGM+FGBI+ON+MDSO+CINF+ARQL+CCNE+AKTX+ARGX+FINX+CETXW+APWC+BYBK+FLN+IBUY+EBSB+GTXI+LKQ+LILA+MACQ+PTH+CHRS+HOMB+PTX+FRTA+INVE+EFII+EGAN+CPST+AGFS+CAPR+LABL+EYEG+AQXP+FSACU+MATW+MATR+ANGO+BCAC+PCMI+HTLD+MDVXW+AXTI+IGOV+FOSL+COUP+PPHMP+IMDZ+NXTM+FDTS+ELTK+LEXEB+JCTCF+HDSN+ISSC+LPNT+ONSIW+ODP+CYRN+EMIF+SKYY+TECH+NMIH+CYRX+MTSI+QVCB+ELGX+IPCC+GILD+FEM+CORI+ESSA+DRAD+MSEX+MDGL+FEX+ADI+EPIX+FBZ+COLL+HEBT+JSYN+IPAS+OPNT+AMOT+HEWG+HRZN+GNMX+MINDP+CPLA+SEED+MTSL+BVXVW+PBCT+NFBK+KFFB+GDEN+CTIB+PXI+BPOP+JTPY+DFNL+DWCH+ACSF+MICTW+ESQ+CWST+FCCY+GOGL+DELT+ISRL+LFVN+MYND+AHPI+EQIX+ANCB+MRTN+RFEU+CECE+SRCE+NVEC+HIIQ&f=sabc1p2jkj6k5t8"
        };
    }

    @Scheduled(
            initialDelayString = "5000",
            fixedDelayString = "300000"
    )
    public void print() throws IOException {
        long end = System.currentTimeMillis();
        //long start = end - 30000;
//        long start = 0;
//        Interval interval = new Interval(start, end);
        System.out.println(end);
        String filename = "/Users/xzhou/Developer/xing/quotes.csv";

        for (int i = 0; i < urls.length; i++) {
            boolean append = true;
            if (i == 0) append = false;
            downloadUsingStream(urls[i], filename, append);
        }
        deaggregator.deaggregate(filename, end);
    }

    private void downloadUsingStream(String urlStr, String file, boolean append) throws IOException {
        URL url = new URL(urlStr);
        BufferedInputStream bis = new BufferedInputStream(url.openStream());
        FileOutputStream fis = new FileOutputStream(file, append);
        byte[] buffer = new byte[1024];
        int count=0;
        while((count = bis.read(buffer,0,1024)) != -1)
        {
            fis.write(buffer, 0, count);
        }
        fis.close();
        bis.close();
    }

//    public static void main(String[] args) throws IOException {
//
//        URL url = new URL(urlStr);
//        BufferedInputStream bis = new BufferedInputStream(url.openStream());
//        FileOutputStream fis = new FileOutputStream("/Users/xzhou/Developer/xing/quotes.csv");
//        byte[] buffer = new byte[1024];
//        int count=0;
//        while((count = bis.read(buffer,0,1024)) != -1)
//        {
//            fis.write(buffer, 0, count);
//        }
//        fis.close();
//        bis.close();
//    }

//    private void downloadUsingNIO(String urlStr, String file) throws IOException {
//        URL url = new URL(urlStr);
//        ReadableByteChannel rbc = Channels.newChannel(url.openStream());
//        FileOutputStream fos = new FileOutputStream(file);
//        fos.getChannel().transferFrom(rbc, 0, Long.MAX_VALUE);
//        fos.close();
//        rbc.close();
//    }
}
